---
title: "Homework 2"
author: "Carmen Canedo"
date: "14 September 2020"
output:
  pdf_document: default
  html_notebook: default
editor_options:
  chunk_output_type: inline
---

# Libraries
I will use the `tidyverse` package to run this code.
```{r, include=FALSE}
library(tidyverse)
```

# Overview
For this assignment, I am using code from *[Project 3 in Hands-On Programming with R](https://rstudio-education.github.io/hopr/project-3-slot-machine.html)*^1^ to complete the first section. I create a slot machine game that can be run using the `play()` function that generates symbols using specified probabilities and calculates the player's score.

In section 2, I modify the function and rename it `play2()`, giving different probabilities for certain symbols. Additionally, I create the function `number_of_turns()` that counts the number of turns each game allows given the initial funds a player has and the cost of the game. Lastly, I provide an analysis for which game allows for the most number of turns by replicating the games 100 times and comparing the average number of turns the game allows.\

^[1]^^[Note, italics indicate hyperlink]^

# Section 1: Project 3

## Creating first slot machine
The function, `play()`, calculates the score that is randomly generated by the following slot machine symbols:

  + DD - diamonds
  + 7 - sevens
  + BBB - triple bars
  + BB - double bars
  + B - single bars
  + C - cherries
  + 0 - zeroes
  
```{r, include=FALSE}
# Function to get three random symbols
get_symbols <- function() {
  
  # Creating character vector containing symbol options
  wheel <- c("DD", "7", "BBB", "BB", "B", "C", "0")
  
  # Producing random sample of symbols, given specific probabilities
  wheel %>% 
    sample(size = 3, replace = TRUE,
           prob = c(0.03, 0.03, 0.06, 0.1, 0.25, 0.01, 0.52))
}
```

```{r, include=FALSE}
# Calculate score
score <- function(symbols) {
  # Identifying the case
  same <- symbols[1] == symbols[2] && symbols[2] == symbols[3]
  bars <- symbols %in% c("B", "BB", "BBB")
  
  # Get prize
  if (same) {
    
    # Listing payouts
    payouts <- c("DD" = 100, "7" = 80, "BBB" = 40, "BB" = 25, "B" = 10, "C" = 10, "0" = 0)
    
    # Assigning prize from payouts vector
    prize <- unname(payouts[symbols[1]])
    
  } else if (all(bars)) {
    
    # Prize if all symbols are bars
    prize <- 5
    
  } else {
    # Counting number of cherries
    cherries <- sum(symbols =="C")
    
    # Assigning prize given number of cherries
    prize <- c(0, 2, 5)[cherries + 1]
    
  }
  
  # Adjust for diamonds
  diamonds <- sum(symbols == "DD")
  prize * 2 ^ diamonds
  
}
```


```{r, include=FALSE}
# Full slot machine
play <- function() {
  
  # Generate symbols
  symbols <- get_symbols()
  
  # Display the symbols
  print(symbols)
  
  # Score the symbols
  score(symbols) %>% 
    print()
  
}
```

## Playing the slot machine
Below is an example of the results of playing the slot machine 3 times. The first line are the symbols the function outputs, and the second line is the calculated score.
```{r, echo=FALSE}
play()

play()

play()
```

# Section 2: Homework 2

## 1. Create `play2()`
`play2()` changes the probabilities of triple bars, zeroes, and cherries, and it adds the values for three single bars. In order to change the probabilities, we need to reassign them in `get_symbols()` above.
```{r, include=FALSE}
# Function to get three random symbols
get_symbols2 <- function() {
  
  # Creating character vector containing symbol options
  wheel <- c("DD", "7", "BBB", "BB", "B", "C", "0")
  
  # Modifying probabilites for triple bars, zeroes, and cherries
  wheel %>% 
    sample(size = 3, replace = TRUE,
           prob = c(0.03, 0.03, 0.075, 0.1, 0.25, 0.015, 0.5))
}
```


```{r, include=FALSE}
play2 <- function() {
  
  # Generate symbols
  symbols <- get_symbols2()
  
  # Display the symbols
  print(symbols)
  
  # Score the symbols
  score(symbols) %>% 
    print()
}
```


## 2. Create `number_of_turns()`
Next, we are going to create a new function that returns the number of turns played before running out of money.
```{r, include=FALSE}
number_of_turns <- function(initial_funds = 100, cost = 2, which_game) {
  
  # Placing the result of the slot machine within the scope of the function
  result <- which_game()
  
  # Adding any points won from score() to funds
   if (result > 0) {
     initial_funds <- initial_funds + result
  }
  
  # Making a list to iterate over that is the length of initial funds
  funds <- seq(0, initial_funds)
  
  # Initializing variable to count the number of turns
  turns <- 0
  
  # Creating for loop to iterate through length of funds sequence
    for (i in funds) {
      
      # Loop runs as long as initial funds is greater than 0
      if (initial_funds > 0) {
        
        # Incrementing value of turns
        turns <- turns + 1
        
        # Updating initial funds value
        initial_funds <- initial_funds - cost
      }
    }
  
  # Printing number of turns
  print(turns)
}
```

## 3. Which game allows for the most turns on average?
```{r, include=FALSE}
# Confirming number of turns works for both functions
number_of_turns(which_game = play)

number_of_turns(which_game = play2)
```

```{r, include=FALSE}
# Replicating the average of both functions 100 times
game_results1 <- replicate(100,
                           mean(number_of_turns(which_game = play))
                           )

game_results2 <- replicate(100, 
                           mean(number_of_turns(which_game = play2))
                           )

# Saving results into dataframe
results <- tibble(avg_play = game_results1, avg_play2 = game_results2)
```

The average number of turns for `play()` and `play2()` when replicated 100 times are as follows.
```{r, echo=FALSE}
# Calculating the mean for both samples
mean(game_results1)

mean(game_results2)
```

It appears the average number of turns for `play2()` has a slight advantage over `play()`, but let's investigate further by comparing the results in bar graphs.

## 4. Supporting analysis for recommendation
```{r, echo=FALSE}
avg_mean1 <- results %>% 
  ggplot(aes(x = avg_play)) +
  geom_bar() +
  labs(title = "Average Number of Turns for `play()` Slot Machine over 100 Repetitions",
       x = "Number of Turns",
       y = "Count of the Averages",
       caption = "STAT-412 | Fall 2020")  +
  theme_bw()

avg_mean1
```

```{r, echo=FALSE}
avg_mean2 <- results %>% 
  ggplot(aes(x = avg_play2)) +
  geom_bar() +
  labs(title = "Average Number of Turns for `play2()` Slot Machine over 100 Repetitions",
       x = "Number of Turns",
       y = "Count of the Averages",
       caption = "STAT-412 | Fall 2020")  +
  theme_bw()

avg_mean2
```

As we can see from the graphs above, `play2()` only has a slight advantage over `play()`, but given that the probabilities are higher for triple bars and cherries in `play2()`, I would reccomend that game.