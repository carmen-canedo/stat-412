---
title: "Homework 7"
author: "Carmen Canedo"
date: "27 November 2020"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Loading Libraries
```{r Load Data, message=FALSE}
source("setup.R")

library(nycflights13)

nycflights13_data <- data(package = "nycflights13")
```

```{r Exploring data}
nycflights13_data$results[, c("Item", "Title")]
head(airlines)
head(airports)
head(flights)
head(planes)
head(weather)
```

# Keys
*Primary keys* uniquely identify an observation within its own table. *Foreign keys* uniquely identify an observation in another table.

To be sure the identification is unique, count the primary keys and see if any are greater than 1.

```{r Confirm unique key 1}
planes %>% 
  count(tailnum) %>% 
  filter(n > 1)
```

```{r Confirm unique key 2}
flights %>% 
  count(year, month, day, flight) %>% 
  filter(n > 1)
```
There is not a primary key in the flights tibble because the values repeat. We need to add a *surrogate key* to flights.

```{r Add surrogate key}
flightskey <- flights %>% 
  rowid_to_column("ID") %>% 
  select(ID, everything())

glimpse(flightskey)
```

## Exercise 1 Identify the primary keys in three datasets. 
Be sure to show that you have the primary key by showing there are no duplicate entries.

### a. Lahman Batting Primary Key
```{r Lahman::Batting PK}
# Loading Library
library(Lahman)

#View(Batting)

# Finding primary key
Batting %>% 
  count(playerID, stint, yearID) %>% 
  filter(n > 1)
```
The primary key for `Lahman::Batting` is `playerID`, `stint`, and `yearID`.

### b. Babynames Primary key
```{r babynames::babynames PK}
library(babynames)

#View(babynames)

# For some reason, when compiling, the code lags here, so I'm commenting it out. This is how I got my answer for this question.
# babynames::babynames %>% 
#   count(name, year, sex) %>% 
#   filter(n > 1)
```
The primary key for `babynames` is `name`, `year`, and `sex`.

### c. Atmos Primary Key
```{r nasaweather::atmos PK}
nasaweather::atmos %>% 
  count(lat, long, year, month) %>% 
  filter(n > 1)
```
the primary key for `atmos` is `lat`, `long`, `year`, `month`.

## Exercise 2 What is the relationship between the Batting, Master, and Salaries tables in the Lahman package? What are the keys for ech dataset and how do they relate to each other?

```{r Explore Lahman data}
View(Batting)
View(Master)
View(Salaries)
```

```{r Master PK}
Master %>% 
  count(playerID) %>% 
  filter(n > 1)
```

```{r Salaries PK}
Salaries %>% 
  count(playerID, teamID, yearID) %>% 
  filter(n > 1)
```


As we know from above, the primary key for `Batting` is `playerID`, `stint`, and `yearID`. The primary key for `Master` is `playerID`, and for `Salaries` it is `playerID`, `teamID`, and `yearID`.

`playerID` in `Master` has a 1 to many relationship in Salaries and Batting.